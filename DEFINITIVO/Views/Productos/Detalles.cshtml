@model Heldu.Entities.Models.Producto
@using Microsoft.AspNetCore.Identity
@using Heldu.Logic.Interfaces
@inject IReviewsService ReviewsService
@{
    ViewData["Title"] = "Detalles";
    List<Review> reviews = await ReviewsService.ObtenerReviewsByProductoId(Model.Id);
    int totalComentarios = ReviewsService.CantidadComentariosByReviewList(reviews);
    int valoracionMedia = await ReviewsService.ObtenerValoracionMediaByProductoId(Model.Id);
    Vendedor vendedor = ViewBag.Vendedor;
    Usuario usuario = ViewBag.Usuario;
    List<OpcionProducto> opcionesProductos = ViewBag.OpcionesProductos;
}

<!-- Link que habilita las estrellas de valoración -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="~/css/Producto_Detalles.css" rel="stylesheet" type="text/css">

<div class="row">
    <div class="col-10 offset-1">
        <div class="titulo-producto-detalles">
            <h2>@Model.Titulo</h2>
            <div>
                <div class="row ubicacion-del-vendedor">
                    <img src="https://image.flaticon.com/icons/svg/684/684908.svg" />
                    <p>Fisioimpacto centro estético; Luis Power 23, 48014, Bilbao</p>
                </div>
                <div class="row media-de-vendedor" style="align-items: baseline;">
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star"></span>
                    <p>(3 opiniones)</p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-7 col-md-7 contenido-producto">
                <div id="carousel-thumb" class="carousel slide carousel-fade carousel-thumbnails" data-ride="carousel">
                    <div class="carousel-inner" role="listbox">
                        <div class="carousel-item active">
                            <img class="d-block imagenes-carousel" src="~/Productos/GetImage1/@Model.Id" alt="First slide">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block imagenes-carousel" src="~/Productos/GetImage2/@Model.Id" onerror="this.parentElement.classList='d-none'" alt="Second slide">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block imagenes-carousel" src="~/Productos/GetImage3/@Model.Id" onerror="this.parentElement.classList='d-none'" alt="Third slide">
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#carousel-thumb" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon icono-carousel" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" id="control-next-carousel" href="#carousel-thumb" role="button" data-slide="next">
                        <span class="carousel-control-next-icon icono-carousel" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                    <div class="carousel-indicators">
                        <a class="normal-thumbnail-carousel active" data-target="#carousel-thumb" data-slide-to="0">
                            <img src="~/Productos/GetImage1/@Model.Id" onerror="this.parentElement.classList='d-none'">
                        </a>
                        <a class="normal-thumbnail-carousel" data-target="#carousel-thumb" data-slide-to="1">
                            <img src="~/Productos/GetImage2/@Model.Id" onerror="this.parentElement.classList='d-none'">
                        </a>
                        <a class="normal-thumbnail-carousel" data-target="#carousel-thumb" data-slide-to="2">
                            <img src="~/Productos/GetImage3/@Model.Id" onerror="this.parentElement.classList='d-none'">
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-lg-5 col-md-5">
                <!-- La parte comentada es como deberá estár una vez todos los productos tengan opciones-->
                @*@foreach (OpcionProducto opcionesDeProducto in opcionesProductos)
                    {
                        <div class="row precios-producto-detalles d-none">
                            <p class="col-4 precio-inicial-opciones">@opcionesDeProducto.PrecioInicial€</p>
                            <p class="col-3 precio-final-opciones">@opcionesDeProducto.PrecioFinal€</p>
                            <p class="col-3 descuento-opciones">@opcionesDeProducto.Descuento</p>
                        </div>
                    }*@
                <div class="row">
                    @*
                        @foreach (OpcionProducto opcionesDeProducto in opcionesProductos)
                        {
                            <p>@opcionesDeProducto.Descripcion</p>
                        }
                    *@
                    <p id="descripcion-de-producto">@Model.Descripcion</p>
                </div>
                <div class="row fecha-y-visitas">
                    <p id="fecha-validez">Hasta el @Model.FechaValidez |</p>
                    <div>
                        <img class="imagen-visitas-detalles" src="https://cdn0.iconfinder.com/data/icons/users-android-l-lollipop-icon-pack/24/group-512.png" />
                        <p id="cantidad-temporal-visitas"></p>
                    </div>
                </div>
                <div class="input-opciones-productos">
                    <form>
                        @if (opcionesProductos.Count == 0 || opcionesProductos.Count == 1)
                        {
                            <div class="row div-opciones-producto" style="align-items:center;">
                                <input class="col-lg-1" type="radio" id="opcion-producto-1" name="opciones-productos" value="">
                                <label class="col-lg-10" for="">@Model.Titulo</label><br>
                            </div>
                        }
                        @if (opcionesProductos.Count > 1)
                        {
                            <div class="row div-opciones-producto" style="align-items:center;">
                                <input class="col-lg-1" type="radio" id="opcion-producto-1" name="opciones-productos" value="">
                                <label class="col-lg-10" for="">@opcionesProductos[0].Titulo</label><br>
                            </div>
                            <div class="row div-opciones-producto" style="align-items:center;">
                                <input class="col-lg-1" type="radio" id="opcion-producto-2" name="opciones-productos" value="">
                                <label class="col-lg-10" for="">@opcionesProductos[1].Titulo</label><br>
                            </div>
                        }
                        @if (opcionesProductos.Count > 2)
                        {
                            <div class="row div-opciones-producto" style="align-items:center;">
                                <input class="col-lg-1" type="radio" id="opcion-producto-3" name="opciones-productos" value="">
                                <label class="col-lg-10" for="">@opcionesProductos[2].Titulo</label>
                            </div>
                        }
                    </form>
                </div>
                <div class="precios-producto-detalles">
                    <div>
                        <p class="descuento-opciones"></p>
                    </div>
                    <div class="precio-inicial-opciones">
                        <p id="precio-inicial-producto">@Model.Precio </p>
                        <p> &#8364 </p>
                    </div>
                    <div class="precio-final-opciones">
                        <p id="precio-final-producto">@Model.PrecioFinal </p>
                        <p> &#8364 </p>
                    </div>
                </div>
                <div class="div-boton-comprar">
                    <a class="btn boton-comprar-producto" onclick="this.disabled=true" asp-controller="Checkout" asp-action="Confirmar" asp-route-id="@Model.Id">Comprar</a>
                    @*<input type="hidden" name="opcion" value="Titulo de la Opcion"/>*@
                </div>
                <label for="showForm" id="reportarProblema">Reportar un problema</label>
            </div>
        </div>
    </div>
</div>
<div class="row seccion-inferior">
    <div class="col-10 offset-1">
        <div class="falso-rou">
            <div class="col-lg-7 barra-opciones-producto">
                <div class="navegador-condiciones-productos">
                    <a class="col-4 anclas-opciones">Condiciones</a>
                    <a class="col-4 anclas-opciones">Opiniones(3)</a>
                    <a class="col-4 anclas-opciones">Preguntas freq.</a>
                </div>
                <div class="contenedor-texto-ocultar">
                    <div class="texto-ocultar condiciones-del-cupon">
                        <h5>Horario: </h5>
                        <ul id="ul-condicion-horario">
                            <li>De lunes a viernes: 9:00 - 17:00</li>
                            <li>Sábado y domingo: 11:00 - 15:00</li>
                        </ul>
                        <h5>Política de reservas: </h5>
                        <ul id="ul-condicion-reserva">
                            <li>Se aceptan reservas</li>
                            <li>Realizar reserva vía telefónica</li>
                        </ul>
                        <h5>Entregas: </h5>
                        <ul id="ul-condicion-entrega">
                            <li>Entregas nacionales</li>
                            <li>Entregas a domicilio</li>
                        </ul>
                        <h5>Otras condiciones: </h5>
                        <ul id="ul-condicion-otros">
                            <li>Se permite más de un cupón por persona</li>
                            <li>Cerrado la 2ª y 3ª semana de Agosto</li>
                        </ul>
                    </div>
                    <div class="texto-ocultar d-none">
                        <!-- Este es el código correspondiete, ahora para el MVP es hard code -->
                        @*@if (reviews.Count() != 0)
                            {
                                foreach (Review review in reviews)
                                {
                                    <p>@review.Comentario</p>
                                    <p>@review.Fecha</p>
                                }
                            }
                            else
                            {
                                <p>
                                    Este producto aún no tiene ninguna review,
                                    @if (User.IsInRole("Cliente"))
                                    {
                                        <button type="button" class="btn btn-outline-info" data-toggle="modal" data-target=".bd-example-modal-lg">Sé el primero</button>
                                    }
                                </p>
                            }*@
                        <!-- 1er comentario Hard Codeado-->
                        <div class="row">
                            <div class="col-lg-2 imagen-comentario-producto">
                                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcQT7NvIfTyhEXEDqrGjBe6Vaak8FpF2sOThf6pkUGkhdvPeYJ-A&usqp=CAU" style="width:inherit;" />
                            </div>
                            <div class="col-lg-6 texto-comentario-producto">
                                <div style="display:flex; flex-direction:row;">
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star"></span>
                                </div>
                                <h5>Janire Rueda</h5>
                                <p>Un servicio rápido, agradable y de buena calidad.¡Volveremos sin duda!</p>
                            </div>
                        </div>
                        <!-- 2do comentario Hard Codeado-->
                        <div class="row">
                            <div class="col-lg-2 imagen-comentario-producto">
                                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcQT7NvIfTyhEXEDqrGjBe6Vaak8FpF2sOThf6pkUGkhdvPeYJ-A&usqp=CAU" style="width:inherit;" />
                            </div>
                            <div class="col-lg-6 texto-comentario-producto">
                                <div style="display:flex; flex-direction:row;">
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star"></span>
                                </div>
                                <h5>Aitor Campos</h5>
                                <p>100% recomendable. Era la primera vez que acudíamos y Arantxa nos atendió y ayudó mucho. Muy profesionales.</p>
                            </div>
                        </div>
                        <!-- 3er comentario Hard Codeado-->
                        <div class="row">
                            <div class="col-lg-2 imagen-comentario-producto">
                                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcQT7NvIfTyhEXEDqrGjBe6Vaak8FpF2sOThf6pkUGkhdvPeYJ-A&usqp=CAU" style="width:inherit;" />
                            </div>
                            <div class="col-lg-6 texto-comentario-producto">
                                <div style="display:flex; flex-direction:row;">
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star checked"></span>
                                    <span class="fa fa-star"></span>
                                </div>
                                <h5>Miren Igartua</h5>
                                <p>Muy buena experiencia.</p>
                            </div>
                        </div>
                    </div>
                    <div class="texto-ocultar d-none">
                    </div>
                </div>
            </div>
            <div class="col-lg-4 offset-lg-1 barra-informacion-vendedor">
                    <h6>@vendedor.NombreDeEmpresa</h6>
                    <a href="@vendedor.Paginaweb">@vendedor.Paginaweb</a>
                    <p>@vendedor.Telefono</p>
                <div class="div-mapa">
                    <iframe scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?width=506&height=400&hl=en&q=Luis%20Power%2023%20Bilbao+(Ubicacion)&t=&z=12&ie=UTF8&iwloc=B&output=embed" width="auto" height="auto" frameborder="0">
                    </iframe>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- MODAL PARA AÑADIR COMENTARIOS-->
<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" style="background: white;">
        <p>¿Qué te ha parecido el producto?</p>
        <div class="modal-content" style="display:flex; flex-direction:row;" id="div-estrellas-modal">
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>
        </div>
        <div class="modal-content">
            <form method="post">
                <input type="text" placeholder="Añada su comentario" name="ComentarioUsuario" asp-action="CrearReview" rows="6" style="width:100%" />
                <input class="d-none" name="valoracionUsuario" type="text" id="incluir-valoracion" asp-action="CrearReview" />
                <input type="submit" value="Enviar comentario" />
            </form>
        </div>
    </div>
</div>

@if (User.IsInRole("admin"))
{
    <div>
        <a asp-action="Edit" asp-route-id="@Model.Id">Edit</a> |
        <a asp-action="Index2">Volver</a>
    </div>
}
@section Scripts {

    <script defer src="~/js/Producto_Detalles.js"></script>
}

