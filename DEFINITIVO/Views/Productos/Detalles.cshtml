@model Heldu.Entities.Models.Producto
@using Microsoft.AspNetCore.Identity
@using Heldu.Logic.Interfaces
@inject IReviewsService ReviewsService
@{
    List<Review> reviews = await ReviewsService.ObtenerReviewsByProductoId(Model.Id);
    int totalComentarios = ReviewsService.CantidadComentariosByReviewList(reviews);
    int valoracionMedia = await ReviewsService.ObtenerValoracionMediaByProductoId(Model.Id);
    Vendedor vendedor = ViewBag.Vendedor;
    Usuario usuario = ViewBag.Usuario;
    List<OpcionProducto> opcionesProductos = ViewBag.OpcionesProductos;
}

<!-- Link que habilita las estrellas de valoración -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="~/css/Producto_Detalles.css" rel="stylesheet" type="text/css">
@*<script defer src="~/js/Producto_Detalles.js"></script>*@

<div class="row">
    <div class="col-10 offset-1">
        <div class="row">
            <div class="col-8 contenido-producto">
                <div id="carousel-thumb" class="carousel slide carousel-fade carousel-thumbnails" data-ride="carousel">
                    <div class="carousel-inner" role="listbox">
                        <div class="carousel-item active">
                            <img class="d-block imagenes-carousel" src="~/Productos/GetImage1/@Model.Id" alt="First slide">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block imagenes-carousel" src="~/Productos/GetImage2/@Model.Id" alt="Second slide">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block imagenes-carousel" src="~/Productos/GetImage3/@Model.Id" alt="Third slide">
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#carousel-thumb" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon icono-carousel" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" id="control-next-carousel" href="#carousel-thumb" role="button" data-slide="next">
                        <span class="carousel-control-next-icon icono-carousel" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                    <div class="carousel-indicators">
                        <a class="normal-thumbnail-carousel active" data-target="#carousel-thumb" data-slide-to="0">
                            <img src="~/Productos/GetImage1/@Model.Id" onerror="this.onerror=null;this.src='https://i.ibb.co/gMsDrL9/NoImage.png';">
                        </a>
                        <a class="normal-thumbnail-carousel" data-target="#carousel-thumb" data-slide-to="1">
                            <img src="~/Productos/GetImage2/@Model.Id" onerror="this.onerror=null;this.src='https://i.ibb.co/gMsDrL9/NoImage.png';">
                        </a>
                        <a class="normal-thumbnail-carousel" data-target="#carousel-thumb" data-slide-to="2">
                            <img src="~/Productos/GetImage3/@Model.Id" onerror="this.onerror=null;this.src='https://i.ibb.co/gMsDrL9/NoImage.png';">
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-4 ">
                <div class="row">
                    <p>Media vendedor:</p>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star checked"></span>
                    <span class="fa fa-star"></span>
                </div>
                <div class="row precios-producto-detalles">
                    <div class="col-3 precio-final-opciones">
                        <div class="row">
                            <p id="precio-final-producto">@Model.PrecioFinal</p>
                            <p> €</p>
                        </div>
                    </div>
                    <div class="col-4 precio-inicial-opciones">
                        <div class="row">
                            <p id="precio-inicial-producto">@Model.Precio</p>
                            <p> €</p>
                        </div>
                    </div>
                    <div class="col-5">
                        <p class="descuento-opciones"></p>
                    </div>
                </div>
                <!-- La parte comentada es como deberá estár una vez todos los productos tengan opciones-->
                @*@foreach (OpcionProducto opcionesDeProducto in opcionesProductos)
                    {
                        <div class="row precios-producto-detalles d-none">
                            <p class="col-4 precio-inicial-opciones">@opcionesDeProducto.PrecioInicial€</p>
                            <p class="col-3 precio-final-opciones">@opcionesDeProducto.PrecioFinal€</p>
                            <p class="col-3 descuento-opciones">@opcionesDeProducto.Descuento</p>
                        </div>
                    }*@
                <div class="row">
                    @*
                        @foreach (OpcionProducto opcionesDeProducto in opcionesProductos)
                        {
                            <p>@opcionesDeProducto.Descripcion</p>
                        }
                    *@
                    <p>@Model.Descripcion</p>
                </div>
                <div class="input-opciones-productos">
                    <form>
                        <input type="radio" id="opcion-producto-1" name="opciones-productos" value="">
                        <label for="male">@Model.Titulo</label><br>
                        @if (opcionesProductos.Count > 1)
                        {
                            <input type="radio" id="opcion-producto-2" name="opciones-productos" value="">
                            <label for="female">@opcionesProductos[1].Titulo</label><br>
                        }
                        @if (opcionesProductos.Count > 2)
                        {
                            <input type="radio" id="opcion-producto-3" name="opciones-productos" value="">
                            <label for="other">@opcionesProductos[2].Titulo</label>
                        }
                    </form>
                </div>
                <div class="row div-fecha-validez">
                    <p>Válido hasta: </p>
                    <p id="fecha-validez">@Model.FechaValidez</p>
                </div>
                <div class="precio-compra-ahorro">
                    <p id="precio-compra">Total...€</p>
                    <p id="cantidad-ahorrada"></p>
                </div>
                <button class="btn boton-comprar-producto" onclick="this.disabled=true">Comprar</button>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-7 offset-1 barra-opciones-producto">
        <div class="navbar navbar-default navegador-condiciones-productos">
            <div class="container-fluid">
                <div class="row ul-opciones-producto">
                    <a class="anclas-opciones">Condiciones</a>
                    <a class="anclas-opciones">Vendedor</a>
                    <a class="anclas-opciones">Opiniones(3)</a>
                </div>
            </div>
        </div>
        <div class="contenedor-texto-ocultar">
            <div class="texto-ocultar">
                <ul id="ul-condicion-horario">
                    <li>Lu - vi: 9:00 - 17:00</li>
                    <li>Sa - do: 11:00 - 15:00</li>
                </ul>
                <ul id="ul-condicion-reserva">
                    <li>Se aceptan reservas</li>
                    <li>Realizar reserva vía telefónica</li>
                </ul>
                <ul id="ul-condicion-entrega">
                    <li>Entregas nacionales</li>
                    <li>Entregas a domicilio</li>
                </ul>
                <ul id="ul-condicion-recogida">
                    <li>Recogida en tienda física</li>
                </ul>
                <ul id="ul-condicion-otros">
                    <li>Sólo un cupón por persona</li>
                    <li>Cerrado la 2ª y 3ª semana de Agosto</li>
                </ul>
            </div>
            <div class="row texto-ocultar d-none">
                <div class="col-4">
                    <p>@vendedor.NombreDeEmpresa</p>
                    <p>@vendedor.Paginaweb</p>
                    <p>@vendedor.Telefono</p>
                    <p>Luis Power 23,</p>
                    <p>48014, Bilbao</p>
                </div>
                <div class="offset-2 div-mapa">
                    <iframe scrolling="no" src="https://maps.google.com/maps?width=506&amp;height=400&amp;hl=en&amp;q=Luis%20Power%2023%20Bilbao+(Ubicacion)&amp;t=&amp;z=12&amp;ie=UTF8&amp;iwloc=B&amp;output=embed">
                    </iframe>
                </div>
            </div>
            <div class="texto-ocultar d-none">
                <!-- Este es el código correspondiete, ahora para el MVP es hard code -->
                @*@if (reviews.Count() != 0)
                    {
                        foreach (Review review in reviews)
                        {
                            <p>@review.Comentario</p>
                            <p>@review.Fecha</p>
                        }
                    }
                    else
                    {
                        <p>
                            Este producto aún no tiene ninguna review,
                            @if (User.IsInRole("Cliente"))
                            {
                                <button type="button" class="btn btn-outline-info" data-toggle="modal" data-target=".bd-example-modal-lg">Sé el primero</button>
                            }
                        </p>
                    }*@
                <!-- 1er comentario Hard Codeado-->
                <div class="row">
                    <div class="col-2">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcQT7NvIfTyhEXEDqrGjBe6Vaak8FpF2sOThf6pkUGkhdvPeYJ-A&usqp=CAU" style="width:inherit;" />
                    </div>
                    <div class="col-6">
                        <div style="display:flex; flex-direction:row;">
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star"></span>
                        </div>
                        <h5>Janire Rueda</h5>
                        <p>Un servicio rápido, agradable y de buena calidad.¡Volveremos sin duda!</p>
                    </div>
                </div>
                <!-- 2do comentario Hard Codeado-->
                <div class="row">
                    <div class="col-2">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcQT7NvIfTyhEXEDqrGjBe6Vaak8FpF2sOThf6pkUGkhdvPeYJ-A&usqp=CAU" style="width:inherit;" />
                    </div>
                    <div class="col-6">
                        <div style="display:flex; flex-direction:row;">
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star"></span>
                        </div>
                        <h5>Aitor Campos</h5>
                        <p>100% recomendable. Era la primera vez que acudíamos y Arantxa nos atendió y ayudó mucho. Muy profesionales.</p>
                    </div>
                </div>
                <!-- 3er comentario Hard Codeado-->
                <div class="row">
                    <div class="col-2">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcQT7NvIfTyhEXEDqrGjBe6Vaak8FpF2sOThf6pkUGkhdvPeYJ-A&usqp=CAU" style="width:inherit;" />
                    </div>
                    <div class="col-6">
                        <div style="display:flex; flex-direction:row;">
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star"></span>
                        </div>
                        <h5>Janire Rueda</h5>
                        <p>Muy buena experiencia.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- MODAL PARA AÑADIR COMENTARIOS-->
<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" style="background: white;">
        <p>¿Qué te ha parecido el producto?</p>
        <div class="modal-content" style="display:flex; flex-direction:row;" id="div-estrellas-modal">
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>
        </div>
        <div class="modal-content">
            <form method="post">
                <input type="text" placeholder="Añada su comentario" name="ComentarioUsuario" asp-action="CrearReview" rows="6" style="width:100%" />
                <input class="d-none" name="valoracionUsuario" type="text" id="incluir-valoracion" asp-action="CrearReview" />
                <input type="submit" value="Enviar comentario" />
            </form>
        </div>
    </div>
</div>

@if (User.IsInRole("admin"))
{
    <div>
        <a asp-action="Edit" asp-route-id="@Model.Id">Edit</a> |
        <a asp-action="Index2">Volver</a>
    </div>
}
<script src="~/js/Producto_Detalles.js"></script>
<script type='text/javascript' src='https://embedmaps.com/google-maps-authorization/script.js?id=9c17717abbd24cb090de87ce36a3eea304e9b281'></script>